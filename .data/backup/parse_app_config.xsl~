<?xml version="1.0"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
    <xsl:output method="xml" version="1.0" encoding="UTF-8" indent="yes" omit-xml-declaration="yes"/>
    <xsl:strip-space elements="*"/>
    <xsl:param name="sUri" select="'/6.2/Flight/ProcessStandby/nameselect/jumpseat/4208/2017-04-06'"/>
    <xsl:template match="/">
        <xsl:variable name="matching-data" select="app-metadata/service[starts-with($sUri, @uri)]"/>
        <!-- if count of node is less than 1 then no match -->
        <!-- if count of node is more than 1 then multiple matches -->
        <xsl:variable name="matching-set">
            <xsl:choose>
                <xsl:when test="count($matching-data) &lt; 1">0</xsl:when>
                <xsl:when test="count($matching-data) &gt; 1">1</xsl:when>
            </xsl:choose>
        </xsl:variable>

        <xsl:variable name="app-node">
            <xsl:choose>
                <xsl:when test="$matching-set = 1">
                    <xsl:variable name="matchingUri">
                        <xsl:call-template name="LongestUriMatch">
                            <xsl:with-param name="matchDataSet" select="$matching-data"/>
                        </xsl:call-template>
                    </xsl:variable>
                    <xsl:copy-of select="$matching-data[@uri=$matchingUri]"/>
                </xsl:when>
                <xsl:otherwise>
                    <error>no matching data</error>
                </xsl:otherwise>
            </xsl:choose>
        </xsl:variable>
        <xsl:copy-of select="$app-node"/>
    </xsl:template>

    <xsl:template name="LongestUriMatch">
        <xsl:param name="matchDataSet"/>
        <xsl:param name="matchIndex" select="1"/>
        <xsl:param name="longestUri" select="''"/>

        <xsl:variable name="matchedUri" select="$matchDataSet[$matchIndex]/@uri"/>
        <xsl:variable name="longStr">
            <xsl:choose>
                <xsl:when test="string-length($longestUri) &gt; string-length($matchedUri)">
                    <xsl:value-of select="$longestUri"/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:value-of select="$matchedUri"/>
                </xsl:otherwise>
            </xsl:choose>
        </xsl:variable>

        <xsl:choose>
            <xsl:when test="count($matchDataSet) &gt; $matchIndex">
                <xsl:call-template name="LongestUriMatch">
                    <xsl:with-param name="matchDataSet" select="$matchDataSet"/>
                    <xsl:with-param name="matchIndex" select="$matchIndex + 1"/>
                    <xsl:with-param name="longestUri" select="$longStr"/>
                </xsl:call-template>
            </xsl:when>
            <xsl:otherwise>
                <xsl:value-of select="$longStr"/>
            </xsl:otherwise>
        </xsl:choose>
    </xsl:template>
</xsl:stylesheet>
